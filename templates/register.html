{{template "base.html" .}}

{{define "content"}}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white text-center">
                    <h3 class="mb-0">Hesap Oluştur</h3>
                </div>
                <div class="card-body">
                    {{if .error}}
                    <div class="alert alert-danger" role="alert">
                        <i class="fas fa-exclamation-triangle"></i> {{.error}}
                    </div>
                    {{end}}
                    {{if .success}}
                    <div class="alert alert-success" role="alert">
                        <i class="fas fa-check-circle"></i> {{.success}}
                    </div>
                    {{end}}
                    <form action="" method="POST" id="registerForm" onsubmit="return validateForm()">
                        <div class="mb-3">
                            <label for="fullName" class="form-label">
                                <i class="fas fa-user"></i> Ad Soyad <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="fullName" name="fullName" 
                                   placeholder="Örn: Ahmet Yılmaz" required>
                            <div class="form-text">Gerçek adınızı ve soyadınızı girin</div>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">
                                <i class="fas fa-envelope"></i> E-posta Adresi <span class="text-danger">*</span>
                            </label>
                            <input type="email" class="form-control" id="email" name="email" 
                                   placeholder="ornek@email.com" required>
                            <div class="form-text">Geçerli bir e-posta adresi girin</div>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">
                                <i class="fas fa-lock"></i> Şifre <span class="text-danger">*</span>
                            </label>
                            <input type="password" class="form-control" id="password" name="password" 
                                   placeholder="En az 6 karakter" required>
                            <div class="form-text">En az 6 karakter olmalı</div>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">
                                <i class="fas fa-lock"></i> Şifre Tekrar <span class="text-danger">*</span>
                            </label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" 
                                   placeholder="Şifrenizi tekrar girin" required>
                            <div class="form-text">Şifrenizi doğrulamak için tekrar girin</div>
                        </div>
                        <div class="mb-3">
                            <label for="captcha" class="form-label">
                                <i class="fas fa-shield-alt"></i> Güvenlik Kodu <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="captcha" name="captcha" 
                                   placeholder="1234" required>
                            <div class="form-text">Güvenlik kodu: 1234</div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="terms" required>
                                <label class="form-check-label" for="terms">
                                    <a href="#" class="text-decoration-none">Kullanım şartlarını</a> ve 
                                    <a href="#" class="text-decoration-none">gizlilik politikasını</a> kabul ediyorum
                                </label>
                            </div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-user-plus"></i> Hesap Oluştur
                            </button>
                        </div>
                    </form>
                    <div class="text-center mt-4">
                        <p class="mb-0">Zaten hesabınız var mı? 
                            <a href="/login" class="text-decoration-none">
                                <i class="fas fa-sign-in-alt"></i> Giriş Yapın
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function validateForm() {
    var password = document.getElementById("password").value;
    var confirmPassword = document.getElementById("confirmPassword").value;
    var email = document.getElementById("email").value;
    var fullName = document.getElementById("fullName").value;
    var captcha = document.getElementById("captcha").value;

    if (fullName.trim().length < 2) {
        alert("Ad soyad en az 2 karakter olmalıdır!");
        return false;
    }
    if (password.length < 6) {
        alert("Şifre en az 6 karakter olmalıdır!");
        return false;
    }
    if (password !== confirmPassword) {
        alert("Şifreler eşleşmiyor!");
        return false;
    }
    if (captcha !== "1234") {
        alert("Güvenlik kodu hatalı!");
        return false;
    }

    // AJAX ile gönder
    fetch("/register", {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: "fullName=" + encodeURIComponent(fullName) + "&email=" + encodeURIComponent(email) + "&password=" + encodeURIComponent(password) + "&confirmPassword=" + encodeURIComponent(confirmPassword) + "&captcha=" + encodeURIComponent(captcha)
    }).then(response => response.json()).then(data => {
        if (data.success) {
            alert("✅ Kayıt başarılı! Lütfen e-postanızı kontrol edin ve doğrulama kodunu onaylayın.");
            window.location.href = "/login";
        } else {
            alert("❌ " + data.message);
        }
    }).catch(error => {
        alert("❌ Bir hata oluştu: " + error);
    });
    return false;
}
}

document.addEventListener('DOMContentLoaded', function() {
    
    // Gerçek zamanlı şifre kontrolü
    document.getElementById('confirmPassword').addEventListener('input', function() {
        var password = document.getElementById('password').value;
        var confirmPassword = this.value;
        
        if (confirmPassword.length > 0) {
            if (password === confirmPassword) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
            }
        } else {
            this.classList.remove('is-valid', 'is-invalid');
        }
    });
    
    // E-posta format kontrolü
    document.getElementById('email').addEventListener('input', function() {
        var email = this.value;
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        
        if (email.length > 0) {
            if (emailRegex.test(email)) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
            }
        } else {
            this.classList.remove('is-valid', 'is-invalid');
        }
    });
    
    // Ad soyad kontrolü
    document.getElementById('fullName').addEventListener('input', function() {
        var fullName = this.value.trim();
        
        if (fullName.length > 0) {
            if (fullName.length >= 2) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
            }
        } else {
            this.classList.remove('is-valid', 'is-invalid');
        }
    });
});
</script>
{{end}} 