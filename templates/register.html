{{template "base.html" .}}

{{define "content"}}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white text-center">
                    <h3 class="mb-0">Hesap Oluştur</h3>
                </div>
                <div class="card-body">
                    {{if .error}}
                    <div class="alert alert-danger" role="alert">
                        <i class="fas fa-exclamation-triangle"></i> {{.error}}
                    </div>
                    {{end}}
                    {{if .success}}
                    <div class="alert alert-success" role="alert">
                        <i class="fas fa-check-circle"></i> {{.success}}
                    </div>
                    {{end}}
                    <form action="/register" method="POST" id="registerForm">
                        <div class="mb-3">
                            <label for="fullName" class="form-label">
                                <i class="fas fa-user"></i> Ad Soyad <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="fullName" name="fullName" 
                                   placeholder="Örn: Ahmet Yılmaz" required>
                            <div class="form-text">Gerçek adınızı ve soyadınızı girin</div>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">
                                <i class="fas fa-envelope"></i> E-posta Adresi <span class="text-danger">*</span>
                            </label>
                            <input type="email" class="form-control" id="email" name="email" 
                                   placeholder="ornek@email.com" required>
                            <div class="form-text">Geçerli bir e-posta adresi girin</div>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">
                                <i class="fas fa-lock"></i> Şifre <span class="text-danger">*</span>
                            </label>
                            <input type="password" class="form-control" id="password" name="password" 
                                   placeholder="En az 6 karakter" required>
                            <div class="form-text">En az 6 karakter olmalı</div>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">
                                <i class="fas fa-lock"></i> Şifre Tekrar <span class="text-danger">*</span>
                            </label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" 
                                   placeholder="Şifrenizi tekrar girin" required>
                            <div class="form-text">Şifrenizi doğrulamak için tekrar girin</div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="robotCheck" required>
                                <label class="form-check-label" for="robotCheck">
                                    <i class="fas fa-robot text-primary"></i> 
                                    <strong>Ben robot değilim</strong> - Bu kutucuğu işaretleyerek insan olduğunuzu doğrulayın
                                </label>
                            </div>
                            <div class="form-text">
                                <i class="fas fa-shield-alt text-success"></i> 
                                Güvenlik için bu adım zorunludur
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="terms" required>
                                <label class="form-check-label" for="terms">
                                    <a href="#" class="text-decoration-none">Kullanım şartlarını</a> ve 
                                    <a href="#" class="text-decoration-none">gizlilik politikasını</a> kabul ediyorum
                                </label>
                            </div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-user-plus"></i> Hesap Oluştur
                            </button>
                        </div>
                    </form>
                    <div class="text-center mt-4">
                        <p class="mb-0">Zaten hesabınız var mı? 
                            <a href="/login" class="text-decoration-none">
                                <i class="fas fa-sign-in-alt"></i> Giriş Yapın
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Form validasyonu
    $('#registerForm').on('submit', function(e) {
        e.preventDefault();
        
        var password = $('#password').val();
        var confirmPassword = $('#confirmPassword').val();
        var email = $('#email').val();
        var fullName = $('#fullName').val();
        var robotCheck = $('#robotCheck').is(':checked');
        
        // Ad soyad kontrolü
        if (fullName.trim().length < 2) {
            alert('Ad soyad en az 2 karakter olmalıdır!');
            return false;
        }
        
        // Şifre kontrolü
        if (password.length < 6) {
            alert('Şifre en az 6 karakter olmalıdır!');
            return false;
        }
        
        // Şifre eşleşme kontrolü
        if (password !== confirmPassword) {
            alert('Şifreler eşleşmiyor!');
            return false;
        }
        
        // Robot kontrolü
        if (!robotCheck) {
            alert('Lütfen "Ben robot değilim" kutucuğunu işaretleyin!');
            return false;
        }
        
        // E-posta format kontrolü
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            alert('Geçerli bir e-posta adresi girin!');
            return false;
        }
        
        // Form verilerini hazırla
        var formData = {
            fullName: fullName,
            email: email,
            password: password,
            confirmPassword: confirmPassword,
            robotCheck: robotCheck
        };
        
        // Form gönderiliyor
        $(this).find('button[type="submit"]').html('<i class="fas fa-spinner fa-spin"></i> Kaydediliyor...');
        $(this).find('button[type="submit"]').prop('disabled', true);
        
        // AJAX ile gönder
        $.ajax({
            url: '/register',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function(response) {
                if (response.success) {
                    alert('Kayıt başarılı! Giriş sayfasına yönlendiriliyorsunuz.');
                    window.location.href = '/login';
                } else {
                    alert('Hata: ' + response.message);
                    $('#registerForm').find('button[type="submit"]').html('<i class="fas fa-user-plus"></i> Hesap Oluştur');
                    $('#registerForm').find('button[type="submit"]').prop('disabled', false);
                }
            },
            error: function(xhr) {
                var response = JSON.parse(xhr.responseText);
                alert('Hata: ' + response.message);
                $('#registerForm').find('button[type="submit"]').html('<i class="fas fa-user-plus"></i> Hesap Oluştur');
                $('#registerForm').find('button[type="submit"]').prop('disabled', false);
            }
        });
    });
    
    // Gerçek zamanlı şifre kontrolü
    $('#confirmPassword').on('input', function() {
        var password = $('#password').val();
        var confirmPassword = $(this).val();
        
        if (confirmPassword.length > 0) {
            if (password === confirmPassword) {
                $(this).removeClass('is-invalid').addClass('is-valid');
            } else {
                $(this).removeClass('is-valid').addClass('is-invalid');
            }
        } else {
            $(this).removeClass('is-valid is-invalid');
        }
    });
    
    // E-posta format kontrolü
    $('#email').on('input', function() {
        var email = $(this).val();
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        
        if (email.length > 0) {
            if (emailRegex.test(email)) {
                $(this).removeClass('is-invalid').addClass('is-valid');
            } else {
                $(this).removeClass('is-valid').addClass('is-invalid');
            }
        } else {
            $(this).removeClass('is-valid is-invalid');
        }
    });
    
    // Ad soyad kontrolü
    $('#fullName').on('input', function() {
        var fullName = $(this).val().trim();
        
        if (fullName.length > 0) {
            if (fullName.length >= 2) {
                $(this).removeClass('is-invalid').addClass('is-valid');
            } else {
                $(this).removeClass('is-valid').addClass('is-invalid');
            }
        } else {
            $(this).removeClass('is-valid is-invalid');
        }
    });
});
</script>
{{end}} 